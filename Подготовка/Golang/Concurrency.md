–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
- [The Go Memory Model](https://go.dev/ref/mem)

---

# –ß—Ç–æ —Ç–∞–∫–æ–µ goroutine?

–ì–æ—Ä—É—Ç–∏–Ω—ã (–∫–æ—Ä—É—Ç–∏–Ω—ã, _–≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö_) ‚Äî —ç—Ç–æ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ ¬´–ø–æ—Ç–æ–∫–∏¬ª, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ **—Ä–∞–Ω—Ç–∞–π–º–æ–º Go**, –∞ –Ω–µ –û–°. –û–Ω–∏ —Ç—Ä–µ–±—É—é—Ç –º–∏–Ω–∏–º—É–º —Ä–µ—Å—É—Ä—Å–æ–≤:

- –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞: **2 –ö–ë** (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Ç–µ—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
- –°–æ–∑–¥–∞—é—Ç—Å—è –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –≤ **–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–±–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤).

## –†–∞–∑–ª–∏—á–∏–µ —Å –ø–æ—Ç–æ–∫–æ–º?

–í –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å **–æ—Ç–ª–∏—á–∏–µ –≤ –ª–µ–≥–∫–æ–≤–µ—Å—Ç–Ω–æ—Å—Ç–∏**. 

- –û–Ω–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è runtime-–æ–º Go, –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ user space (—É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å–∞–º–∏–º —è–∑—ã–∫–æ–º).
- –£ –Ω–∏—Ö –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π stack, –º–æ–∂–µ—Ç –∫–∞–∫ —Ä–∞—Å—Ç–∏, —Ç–∞–∫ –∏ —Å—É–∂–∞—Ç—å—Å—è. 
- –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø–æ—Ç–æ–∫–æ–≤, –æ–Ω–∏ —Ç—Ä–µ–±—É—é—Ç –≥–æ—Ä–∞–∑–¥–æ –º–µ–Ω—å—à–µ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏.

–í –∏—Ç–æ–≥–µ:
- **–ü–æ—Ç–æ–∫–∏** ‚Äî —Ç—è–∂–µ–ª—ã–µ, —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –û–°, –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥–µ—Ä.
- **–ì–æ—Ä—É—Ç–∏–Ω—ã** ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ, —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è Go, –∏–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (–º–Ω–æ–≥–æ –∑–∞–¥–∞—á —Å I/O).
- **GMP-–º–æ–¥–µ–ª—å** –ø–æ–∑–≤–æ–ª—è–µ—Ç Go –∑–∞–ø—É—Å–∫–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–º —á–∏—Å–ª–µ –ø–æ—Ç–æ–∫–æ–≤ –û–°, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã.

### –ü–æ—á–µ–º—É –≥–æ—Ä—É—Ç–∏–Ω—ã ¬´–±—ã—Å—Ç—Ä—ã–µ¬ª?

- **–î–µ—à–µ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ**:
```go
// –ê–ª–ª–æ–∫–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç ~300 –Ω—Å (–≤ 1000 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ –ø–æ—Ç–æ–∫–æ–≤).
go func() { ... }
```
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**:
	- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏ –∑–∞–Ω–∏–º–∞–µ—Ç ~100 –Ω—Å (–Ω–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —è–¥—Ä–∞).
	- –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º Go, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é** –∏ **–≤—ã—Ç–µ—Å–Ω—è—é—â—É—é** –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å.
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**:
	- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω—ã –≥–æ—Ä—É—Ç–∏–Ω –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –û–°.

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –∏ –≥–æ—Ä—É—Ç–∏–Ω

| **–ö—Ä–∏—Ç–µ—Ä–∏–π**            | **–ü–æ—Ç–æ–∫ –û–°**                | **–ì–æ—Ä—É—Ç–∏–Ω–∞**                     |
| ----------------------- | --------------------------- | -------------------------------- |
| **–ü–∞–º—è—Ç—å –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä** | 1‚Äì8 –ú–ë                      | 2 –ö–ë ‚Üí –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Ç–µ—Ç        |
| **–°–æ–∑–¥–∞–Ω–∏–µ**            | –ú–µ–¥–ª–µ–Ω–Ω–æ (—Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã) | –ë—ã—Å—Ç—Ä–æ (—Ä–∞–Ω—Ç–∞–π–º Go)              |
| **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**        | 1‚Äì10 –º–∫—Å (–∫–æ–Ω—Ç–µ–∫—Å—Ç —è–¥—Ä–∞)    | ~100 –Ω—Å (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º) |
| **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**         | –û–°                          | –†–∞–Ω—Ç–∞–π–º Go (GMP-–º–æ–¥–µ–ª—å)          |
| **–ú–∞–∫—Å–∏–º—É–º**            | ~10 000 (–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ)       | –ú–∏–ª–ª–∏–æ–Ω—ã                         |

## –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã —É goroutine –∏ –ø–æ—Ç–æ–∫–∞?

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ—Ç–æ–∫–∞ –û–° (OS Thread Context)

#### –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç

- **–°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤**: 
	- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–æ–±—ã—á–Ω–æ **1‚Äì8 –ú–ë**, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –û–°, –≤ **Linux 8 –ú–ë**).
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 
	- –†–µ–≥–∏—Å—Ç—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (—Ä–µ–∞–ª—å–Ω—ã–µ), —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞, —Ñ–ª–∞–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã**: 
	- –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã —Ñ–∞–π–ª–æ–≤, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Ç–æ–∫–∞ (TID).
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –û–°**: 
	- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–° —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ—Ç–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç CPU.

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

- –ü–æ—Ç–æ–∫–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **—è–¥—Ä–æ–º –û–°** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Linux, Windows).
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç **–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —è–¥—Ä–∞** (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã).

#### –ü—Ä–∏–º–µ—Ä

**–ù–∞ —è–∑—ã–∫–µ C**, –¥–ª—è –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏:

```c
#include <pthread.h>
void* task(void* arg) {
    printf("Hello from OS thread!");
    return NULL;
}
int main() {
    pthread_t thread;
    pthread_create(&thread, NULL, task, NULL);
    pthread_join(thread, NULL);
    return 0;
}
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã (Goroutine Context)

#### –ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç

- **–°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤**: 
	- –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä ‚Äî **2 –ö–ë**, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**:
	- –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ –∫–æ–¥–µ (—Å—á–µ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥), —Ä–µ–≥–∏—Å—Ç—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ).
- **–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:
	- –ö–∞–Ω–∞–ª—ã, `defer`-–≤—ã–∑–æ–≤—ã, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏, –º–µ—Ç–∫–∏ –¥–ª—è —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞.
- **–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**:
	- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, –≤ –∫–∞–∫–æ–º –ø–æ—Ç–æ–∫–µ –û–° (**M**) –∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ (**P**) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≥–æ—Ä—É—Ç–∏–Ω–∞.

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

- –ì–æ—Ä—É—Ç–∏–Ω—ã —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º Go** (–Ω–µ –û–°).
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º —Ä–µ–∂–∏–º–µ** (–±–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤).

#### –ü—Ä–∏–º–µ—Ä

```go
go func() { 
    fmt.Println("Hello from goroutine!") 
}()
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ (Go –∏ –û–°)

|**–ö—Ä–∏—Ç–µ—Ä–∏–π**|**–ì–æ—Ä—É—Ç–∏–Ω–∞**|**–ü–æ—Ç–æ–∫ –û–°**|
|---|---|---|
|**–°–æ–∑–¥–∞–Ω–∏–µ**|~300 –Ω—Å, –Ω–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤|~10‚Äì100 –º–∫—Å, —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã|
|**–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**|~100 –Ω—Å (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º)|~1‚Äì10 –º–∫—Å (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–¥—Ä–∞)|
|**–ü–∞–º—è—Ç—å –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä**|2 –ö–ë (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫)|1‚Äì8 –ú–ë (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫)|
|**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**|–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go (GMP-–º–æ–¥–µ–ª—å)|–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–°|
|**–ú–∞–∫—Å–∏–º—É–º**|–ú–∏–ª–ª–∏–æ–Ω—ã (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ RAM)|~10 000 (–ª–∏–º–∏—Ç—ã –û–°)|

# –ü—Ä–∏–º–∏—Ç–∏–≤—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–í –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –∏ –º–Ω–æ–≥–æ–≥–æ—Ä—É—Ç–∏–Ω–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã:

- **–ú—å—é—Ç–µ–∫—Å—ã (Mutex)**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—â–µ–º—É —Ä–µ—Å—É—Ä—Å—É.
- **RWMutex (Read-Write Mutex)**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º—å—é—Ç–µ–∫—Å –¥–ª—è —á–∞—Å—Ç–æ–≥–æ —á—Ç–µ–Ω–∏—è.
- **–°–µ–º–∞—Ñ–æ—Ä—ã (Semaphore)**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É "—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π".
- **–ö–∞–Ω–∞–ª—ã (Channels)**: –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è + –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö).
- **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (Atomic)**: –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤ (int, pointer).
- **–£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (Cond)**: –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –º—å—é—Ç–µ–∫—Å–∞.
- **–ì—Ä—É–ø–ø—ã –æ–∂–∏–¥–∞–Ω–∏—è (WaitGroup)**: –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –≥–æ—Ä—É—Ç–∏–Ω.

## –ö–∞–∫–∏–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã –µ—Å—Ç—å –≤ Go?

–í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ Go (`sync` –∏ `sync/atomic`) –¥–æ—Å—Ç—É–ø–Ω—ã:

- **`sync.Mutex`** ‚Äì –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.    
- **`sync.RWMutex`** ‚Äì –º—å—é—Ç–µ–∫—Å —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å.
- **`sync.WaitGroup`** ‚Äì –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω.
- **`sync.Once`** ‚Äì –æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞.
- **`sync.Cond`** ‚Äì —É—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.
- **`atomic` (–ø–∞–∫–µ—Ç)** ‚Äì –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (Add, CompareAndSwap, Load, Store).
- **–ö–∞–Ω–∞–ª—ã (`chan`)** ‚Äì —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è + –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö.

## –ß—Ç–æ —Ç–∞–∫–æ–µ mutex?

[Source code](https://github.com/golang/go/blob/master/src/sync/mutex.go#L30)

`sync.Mutex` ‚Äì —ç—Ç–æ –ø—Ä–∏–º–∏—Ç–∏–≤ –¥–ª—è **–≤–∑–∞–∏–º–Ω–æ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (mutual exclusion)**, –∫–æ—Ç–æ—Ä—ã–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Å–µ–∫—Ü–∏—é –∫–æ–¥–∞.

```go
// Mutex - —ç—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–∑–∞–∏–º–Ω–æ–≥–æ –∏—Å–∫–ª—é—á–µ–Ω–∏—è.
// –ù—É–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è Mutex - —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º—å—é—Ç–µ–∫—Å.
// 
// Mutex –Ω–µ –¥–æ–ª–∂–µ–Ω –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
//
// –í —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏ [–º–æ–¥–µ–ª–∏ –ø–∞–º—è—Ç–∏ Go],
// n-–π –≤—ã–∑–æ–≤ [Mutex.Unlock] ¬´—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è¬ª –ø–µ—Ä–µ–¥ m-–º –≤—ã–∑–æ–≤–æ–º [Mutex.Lock] 
// –¥–ª—è –ª—é–±–æ–≥–æ n < m.
// –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ [Mutex.TryLock] —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ–Ω –≤—ã–∑–æ–≤—É Lock.
// –ù–µ—É–¥–∞—á–Ω—ã–π –≤—ã–∑–æ–≤ TryLock –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∏–∫–∞–∫–æ–π —Å–≤—è–∑–∏ ¬´—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ¬ª 
// –≤–æ–æ–±—â–µ.
type Mutex struct {
	_ noCopy

	mu isync.Mutex
}

// –õ–æ–∫–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å.
type Locker interface {
	Lock()
	Unlock()
}
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏?

#### –°–æ—Å—Ç–æ—è–Ω–∏–µ –º—å—é—Ç–µ–∫—Å–∞

–í–Ω—É—Ç—Ä–∏ `sync.Mutex` —Å–æ–¥–µ—Ä–∂–∏—Ç:

- `state` (int32) ‚Äì —Ñ–ª–∞–≥–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –æ–∂–∏–¥–∞—é—â–∏–µ –≥–æ—Ä—É—Ç–∏–Ω—ã.
- `sema` (uint32) ‚Äì —Å–µ–º–∞—Ñ–æ—Ä –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—á–µ—Ä–µ–∑ –û–° –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏).

#### **–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã** (—É–ø—Ä–æ—â—ë–Ω–Ω–æ)
1. **–ü–æ–ø—ã—Ç–∫–∞ –±—ã—Å—Ç—Ä–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**:
   –ì–æ—Ä—É—Ç–∏–Ω–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ `Locked` —á–µ—Ä–µ–∑ `atomic.CompareAndSwapInt32`.
   –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Äì –º—å—é—Ç–µ–∫—Å –∑–∞—Ö–≤–∞—á–µ–Ω.
2. **–û–∂–∏–¥–∞–Ω–∏–µ (–µ—Å–ª–∏ –º—å—é—Ç–µ–∫—Å –∑–∞–Ω—è—Ç)**:
   –ì–æ—Ä—É—Ç–∏–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è –∏ "–∑–∞—Å—ã–ø–∞–µ—Ç" (—á–µ—Ä–µ–∑ `runtime.semacquire`).
3. **–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞**:
   –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º—å—é—Ç–µ–∫—Å –∏ –±—É–¥–∏—Ç –æ–¥–Ω—É –∏–∑ –∂–¥—É—â–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω (—á–µ—Ä–µ–∑ `runtime.semrelease`).

### –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å mutex –Ω–∞ atomic-–∞—Ö?

–ü—Ä–æ—Å—Ç–µ–π—à–∏–π **—Å–ø–∏–Ω–ª–æ–∫ (spinlock)** –Ω–∞ –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö:

```go
type SpinLock struct {
    state *int32
}

const (
    unlocked int32 = 0
    locked   int32 = 1
)

func (s *SpinLock) Lock() {
    for !atomic.CompareAndSwapInt32(s.state, unlocked, locked) {
        // "–ö—Ä—É—Ç–∏—Ç—Å—è" –≤ —Ü–∏–∫–ª–µ, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
        runtime.Gosched() // –û—Ç–¥–∞–µ–º CPU, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —è–¥—Ä–æ
    }
}

func (s *SpinLock) Unlock() {
    atomic.StoreInt32(s.state, unlocked)
}
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ —Å–ø–∏–Ω–ª–æ–∫–∞**:

- –¢—Ä–∞—Ç–∏—Ç CPU, –ø–æ–∫–∞ –∂–¥–µ—Ç (–ø–ª–æ—Ö–æ –¥–ª—è –¥–æ–ª–≥–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫).
- –í Go —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `sync.Mutex` —É–º–Ω–µ–µ: –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å–ø–∏–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è.

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å goroutine, –∫–æ–≥–¥–∞ –æ–Ω–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ Lock?

1. **–ü–æ–ø—ã—Ç–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞—Ö–≤–∞—Ç–∞**:
   –ê—Ç–æ–º–∞—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º—å—é—Ç–µ–∫—Å —Å–≤–æ–±–æ–¥–µ–Ω (`state == 0`). –ï—Å–ª–∏ –¥–∞ ‚Äì –≥–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ.
2. **–û–∂–∏–¥–∞–Ω–∏–µ (–µ—Å–ª–∏ –º—å—é—Ç–µ–∫—Å –∑–∞–Ω—è—Ç)**:
	- –ì–æ—Ä—É—Ç–∏–Ω–∞ **–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞–Ω–∏—è** –º—å—é—Ç–µ–∫—Å–∞.
    - –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ **—Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è** (–Ω–µ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç CPU, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–∑–±—É–∂–µ–Ω–∞).
    - –ü—Ä–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–µ (`Unlock()`) –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go –±—É–¥–∏—Ç —Å–ª–µ–¥—É—é—â—É—é –≥–æ—Ä—É—Ç–∏–Ω—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏.
3. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã (–µ—Å–ª–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –≤—ã—Å–æ–∫–∞—è)**:
   –ï—Å–ª–∏ –±–æ—Ä—å–±–∞ –∑–∞ –º—å—é—Ç–µ–∫—Å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **—Å–µ–º–∞—Ñ–æ—Ä—ã –û–°** (—á–µ—Ä–µ–∑ `runtime.semacquire`).

## –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã –≤ Go

### `sync.RWMutex` (Read-Write Mutex)

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ "–º–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è, —Ä–µ–¥–∫–æ –∑–∞–ø–∏—Å—å":

```go
var rwMu sync.RWMutex

func read() {
    rwMu.RLock()   // –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –≥–æ—Ä—É—Ç–∏–Ω –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å
    defer rwMu.RUnlock()
    // –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    // ...
}

func write() {
    rwMu.Lock()    // –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –ø–∏—à–µ—Ç
    defer rwMu.Unlock()
    // –ó–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö
    // ...
}
```

### `sync.WaitGroup`

–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã –≥–æ—Ä—É—Ç–∏–Ω:

```go
var wg sync.WaitGroup

for i := 0; i < 10; i++ {
    wg.Add(1)
    go func() {
        defer wg.Done()
        // –†–∞–±–æ—Ç–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã
    }()
}

wg.Wait() // –û–∂–∏–¥–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö
```

### `sync.Once`

–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–æ–¥ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ä–æ–≤–Ω–æ 1 —Ä–∞–∑:

```go
var once sync.Once

func setup() {
    once.Do(func() {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è 1 —Ä–∞–∑)
    })
}
```

### `sync.Cond` (–£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ)

–£—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ **–ø–æ–∑–≤–æ–ª—è—é—Ç** –≥–æ—Ä—É—Ç–∏–Ω–∞–º **–æ–∂–∏–¥–∞—Ç—å –∏–ª–∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å** –æ —Å–æ–±—ã—Ç–∏—è—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö **—Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è**.  
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –º—å—é—Ç–µ–∫—Å–æ–º (`sync.Mutex` –∏–ª–∏ `sync.RWMutex`).

**–ù–∞–ø—Ä–∏–º–µ—Ä**, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á –∏–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–∞.

#### –ü—Ä–∏–º–µ—Ä

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ì–æ—Ä—É—Ç–∏–Ω–∞ 1 –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ `cond.Wait()`, –æ—Å–≤–æ–±–æ–∂–¥–∞—è –º—å—é—Ç–µ–∫—Å.
2. –ì–æ—Ä—É—Ç–∏–Ω–∞ 2 –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ (`ready = true`) –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `cond.Signal()`.
3. –ì–æ—Ä—É—Ç–∏–Ω–∞ 1 –ø—Ä–æ—Å—ã–ø–∞–µ—Ç—Å—è, —Å–Ω–æ–≤–∞ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –º—å—é—Ç–µ–∫—Å –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏–µ (`!ready`).

```go
package main

import (
	"fmt"
	"sync"
	"time"
)

func main() {
	var (
		mu    sync.Mutex
		cond  = sync.NewCond(&mu)
		ready bool
	)

	// –ì–æ—Ä—É—Ç–∏–Ω–∞-–æ–∂–∏–¥–∞—Ç–µ–ª—å
	go func() {
		mu.Lock()
		for !ready { // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ü–∏–∫–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å–ª–æ–≤–∏—è!
			cond.Wait() // –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –º—å—é—Ç–µ–∫—Å –∏ –∂–¥—ë—Ç —Å–∏–≥–Ω–∞–ª–∞
		}
		fmt.Println("–°–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ!")
		mu.Unlock()
	}()

	// –ì–æ—Ä—É—Ç–∏–Ω–∞-—Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
	time.Sleep(2 * time.Second)
	mu.Lock()
	ready = true
	cond.Signal() // –ü—Ä–æ–±—É–∂–¥–∞–µ—Ç –æ–¥–Ω—É –≥–æ—Ä—É—Ç–∏–Ω—É (–∏–ª–∏ Broadcast() –¥–ª—è –≤—Å–µ—Ö)
	mu.Unlock()

	time.Sleep(time.Second)
}

// Output:
// –°–æ–±—ã—Ç–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ!
```

### `atomic` (–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)

–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–µ–∑ –º—å—é—Ç–µ–∫—Å–æ–≤. 

–ü–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –Ω–∞–ø—Ä–∏–º–µ—Ä: **—Å—á–µ—Ç—á–∏–∫–æ–≤**, **—Ñ–ª–∞–≥–æ–≤** –∏ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤.

####   –ü—Ä–∏–º–µ—Ä—ã

##### –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á–µ—Ç—á–∏–∫

```go
var (
	counter int32
	wg      sync.WaitGroup
)

for i := 0; i < 100; i++ {
	wg.Add(1)
	go func() {
		atomic.AddInt32(&counter, 1) // –ê—Ç–æ–º–∞—Ä–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ
		wg.Done()
	}()
}

wg.Wait()
fmt.Println("Counter:", counter) // –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ 100
```

##### –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Ñ–ª–∞–≥

```go
var (
	flag  int32 // 0 = false, 1 = true
)

// –ì–æ—Ä—É—Ç–∏–Ω–∞ –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥
go func() {
	time.Sleep(500 * time.Millisecond)
	atomic.StoreInt32(&flag, 1) // –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å
}()

// –û–∂–∏–¥–∞–Ω–∏–µ —Ñ–ª–∞–≥–∞
for atomic.LoadInt32(&flag) == 0 {
	fmt.Println("–û–∂–∏–¥–∞–µ–º...")
	time.Sleep(100 * time.Millisecond)
}
fmt.Println("–§–ª–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
```

### –ö–∞–Ω–∞–ª—ã (Channels)

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è + –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö:

```go
ch := make(chan int)

go func() {
    ch <- 42  // –û—Ç–ø—Ä–∞–≤–∫–∞
}()

val := <-ch  // –ü–æ–ª—É—á–µ–Ω–∏–µ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –ø–æ–∫–∞ –Ω–µ –ø—Ä–∏–¥—É—Ç –¥–∞–Ω–Ω—ã–µ)
```

### `sync.Map` (–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –º–∞–ø–∞)

–î–ª—è —Ä–µ–¥–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π –∏ —á–∞—Å—Ç—ã—Ö —á—Ç–µ–Ω–∏–π –≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–π —Å—Ä–µ–¥–µ. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è `map` + `Mutex` —á–∞—Å—Ç–æ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

```go
var sm sync.Map

// –ó–∞–ø–∏—Å—å (–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è)
sm.Store("key1", 100)
sm.Store("key2", 200)

// –ß—Ç–µ–Ω–∏–µ
if val, ok := sm.Load("key1"); ok {
	fmt.Println("key1:", val) // 100
}

// –£–¥–∞–ª–µ–Ω–∏–µ
sm.Delete("key2")

// –ò—Ç–µ—Ä–∞—Ü–∏—è
sm.Range(func(key, val any) bool {
	fmt.Printf("%v: %v\n", key, val)
	return true // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Ç–µ—Ä–∞—Ü–∏—é
})
```


#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–≤–∞ —É—Ä–æ–≤–Ω—è –¥–∞–Ω–Ω—ã—Ö**: "read" (–¥–ª—è —á–∞—Å—Ç–æ–≥–æ —á—Ç–µ–Ω–∏—è) –∏ "dirty" (–¥–ª—è —Ä–µ–¥–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π).
- –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö —á—Ç–µ–Ω–∏—è—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—á—Ç–∏ –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –º–∞–ø–∞ (–±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫).
- –ü—Ä–∏ –∑–∞–ø–∏—Å–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–¥–∫–∏–µ –º—å—é—Ç–µ–∫—Å—ã.

##### –ü–ª—é—Å—ã

- - –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è –≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è "—Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å" –ø—Ä–∏ –∑–∞–ø–∏—Å–∏.

##### –ú–∏–Ω—É—Å—ã

- –ù–µ –∑–∞–º–µ–Ω—è–µ—Ç `map` + `Mutex` –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø–∏—Å–µ–π.
- –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –∑–∞ –ø–∞–º—è—Ç—å—é (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç `sync.Pool`).
- –í `sync.Map` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ `any` –∑–Ω–∞—á–µ–Ω–∏—è —Å type cast-–æ–º, —á—Ç–æ **–º–æ–∂–µ—Ç** –Ω–µ—Å—Ç–∏ —Ä–∏—Å–∫–∏ –ø–∞–Ω–∏–∫–∏ –≤ production.

#### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ `sync.Map`, –µ—Å–ª–∏ –µ—Å—Ç—å map + mutex

`sync.Map` - **—ç—Ç–æ –æ—Å–æ–±—ã–π —Å–ª—É—á–∞–π** (_[–æ—Ç–≤–µ—Ç –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](https://github.com/golang/go/blob/master/src/sync/map.go#L13-L39)_).¬†–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–º —Ö–≤–∞—Ç–∞–µ—Ç –æ–±—ã—á–Ω–æ map + mutex.

–ï—Å–ª–∏ –≤—Å—ë-—Ç–∞–∫–∏ –∑–∞—Ö–æ—Ç–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –æ —Ç–æ–º, —á—Ç–æ `sync.Map` –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è 2 –∫–µ–π—Å–æ–≤:
1. –ö–æ–≥–¥–∞ map - —ç—Ç–æ **–∫—ç—à**.
	1. –¢.–µ. –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∏—à–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑ —Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è.
2. –ö–æ–≥–¥–∞ —Ä–∞–∑–Ω—ã–µ goroutine —Ä–∞–±–æ—Ç–∞—é—Ç —Å **–Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏–º–∏—Å—è –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞–º–∏ –∫–ª—é—á–µ–π** `sync.Map`.
	2. –¢.–µ.: –∫–æ–≥–¥–∞ –µ—Å—Ç—å –Ω–∞–ø—Ä–∏–º–µ—Ä **3 —à—Ç. goroutine** –∏ —É –Ω–∏—Ö –≤—Å–µ—Ö –µ—Å—Ç—å **1** `sync.Map`, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –∫–∞–∂–¥–æ–π goroutine –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **—Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã** (–º–Ω–æ–∂–µ—Å—Ç–≤–æ) **–∫–ª—é—á–µ–π** (–∫–∞–∂–¥–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ—ë –º–Ω–æ–∂–µ—Å—Ç–≤–æ).

–í —ç—Ç–∏—Ö –¥–≤—É—Ö —Å–ª—É—á–∞—è—Ö –º—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–æ–∏–≥—Ä–∞–µ–º –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏, –µ—Å–ª–∏ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—É—é map + mutex.

##### –ü—Ä–∞–≤–∏–ª–æ: "–û—á–µ–Ω—å –º–Ω–æ–≥–æ —á—Ç–µ–Ω–∏–π, —Ä–µ–¥–∫–æ ‚Äî –∑–∞–ø–∏—Å–∏"

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sync.Map`, –µ—Å–ª–∏ —É –≤–∞—Å:

- **–ß–∞—Å—Ç—ã–µ `Load` (—á—Ç–µ–Ω–∏–µ)** ‚Äî —Ç—ã—Å—è—á–∏ –∏–ª–∏ –º–∏–ª–ª–∏–æ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–µ–∫—É–Ω–¥—É.
- **–†–µ–¥–∫–∏–µ `Store` (–∑–∞–ø–∏—Å—å)** ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É –∏–ª–∏ —Ä–µ–∂–µ.
- **–ù–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ 100% –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** (–∏–∑-–∑–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ `sync.Map`).

##### –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è `sync.Map`

1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–µ–¥–∫–æ (—Ä–∞–∑ –≤ —á–∞—Å/–¥–µ–Ω—å).
2. **–°—á–µ—Ç—á–∏–∫–∏ –º–µ—Ç—Ä–∏–∫** –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (—á–∞—Å—Ç—ã–µ —á—Ç–µ–Ω–∏—è, —Ä–µ–¥–∫–∏–µ —Å–±—Ä–æ—Å—ã).
3. **Lookup-—Ç–∞–±–ª–∏—Ü—ã** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –≤–∞–ª—é—Ç –∏–ª–∏ —Å—Ç—Ä–∞–Ω).

##### –ö–æ–≥–¥–∞ `map + Mutex` –ª—É—á—à–µ?

**–ö–æ—Ä–æ—Ç–∫–æ**

- –í—ã–±–µ—Ä–∏—Ç–µ `sync.Map` –µ—Å–ª–∏:  
    **–ß—Ç–µ–Ω–∏—è** >> **–ó–∞–ø–∏—Å–∏** (—Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ ‚â• 100:1).
- –í—ã–±–µ—Ä–∏—Ç–µ `map + RWMutex` –µ—Å–ª–∏:  
    –ó–∞–ø–∏—Å–∏ —á–∞—Å—Ç—ã–µ –∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–∞–º—è—Ç—å—é.

> "–ï—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—Ç–µ—Å—å ‚Äî —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥ —Å–≤–æ—é –Ω–∞–≥—Ä—É–∑–∫—É. `sync.Map` ‚Äî —É–∑–∫–æ—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∞ –Ω–µ –∑–∞–º–µ–Ω–∞ –≤—Å–µ–º –º–∞–ø–∞–º."  
> ‚Äî _–°–æ–≤–µ—Ç –∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã Go_

**–ü–æ–¥—Ä–æ–±–Ω–æ**

–û–±—ã—á–Ω–∞—è `map` —Å –º—å—é—Ç–µ–∫—Å–æ–º (`sync.Mutex` –∏–ª–∏ `sync.RWMutex`) –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ, –µ—Å–ª–∏:

- –ó–∞–ø–∏—Å–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç **—á–∞—Å—Ç–æ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥).
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π **–Ω–µ–≤–µ–ª–∏–∫–æ** (–º–µ–Ω–µ–µ 1000).
- –¢—Ä–µ–±—É–µ—Ç—Å—è **–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ real-time —Å–∏—Å—Ç–µ–º–∞—Ö).

###### –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è `map + Mutex`

1. **–°—á–µ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API**, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ.
2. **–ö–µ—à —Å–µ—Å—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**, –≥–¥–µ –∑–∞–ø–∏—Å–∏ –∏–¥—É—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ.
3. **–ë—ã—Å—Ç—Ä—ã–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –ø–∞–º—è—Ç–∏).

##### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| **–û–ø–µ—Ä–∞—Ü–∏—è**       | **`sync.Map`**           | **`map + RWMutex`**   |
| ------------------ | ------------------------ | --------------------- |
| **–ß–∞—Å—Ç—ã–µ `Load`**  | ‚ö° –ë—ã—Å—Ç—Ä–æ (lock-free)     | –°—Ä–µ–¥–Ω–µ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)   |
| **–ß–∞—Å—Ç—ã–µ `Store`** | üê¢ –ú–µ–¥–ª–µ–Ω–Ω–æ (–∫–æ–ø–ø–∏–Ω–≥)    | ‚ö° –ë—ã—Å—Ç—Ä–æ (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) |
| **–ü–∞–º—è—Ç—å**         | –í—ã—à–µ (–¥–≤–æ–π–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ) | –ù–∏–∂–µ                  |

##### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ `sync.Map`

–ü–æ—á–µ–º—É `sync.Map` –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ —Ä–µ–¥–∫–∏—Ö –∑–∞–ø–∏—Å—è—Ö?

1. **–î–≤–∞ —É—Ä–æ–≤–Ω—è –¥–∞–Ω–Ω—ã—Ö**:
    - `read` (atomic-–¥–æ—Å—Ç—É–ø, –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫) ‚Äî –¥–ª—è —á—Ç–µ–Ω–∏—è.
    - `dirty` (—Ç—Ä–µ–±—É–µ—Ç –º—å—é—Ç–µ–∫—Å–∞) ‚Äî –¥–ª—è –∑–∞–ø–∏—Å–∏.
2. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏**:
    - –ï—Å–ª–∏ –≤ `dirty` –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, `read` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ.
3. **"–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ" –∫–ª—é—á–∏**:
    - –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø–∏—Å—è—Ö `sync.Map` –º–æ–∂–µ—Ç –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞—Ç—å –¥–æ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

##### –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ —Å –±–µ–Ω—á–º–∞—Ä–∫–æ–º (–∫–æ–≥–¥–∞ `sync.Map` –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç)

–í 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ `sync.Map`:

```go
package main

import (
	"sync"
	"testing"
)

// –¢–µ—Å—Ç –¥–ª—è —á–∞—Å—Ç—ã—Ö —á—Ç–µ–Ω–∏–π –∏ —Ä–µ–¥–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π
func BenchmarkSyncMap(b *testing.B) {
	var sm sync.Map
	sm.Store("key", "value")

	for i := 0; i < b.N; i++ {
		sm.Load("key") // 100% —á—Ç–µ–Ω–∏–µ
	}
}

func BenchmarkMutexMap(b *testing.B) {
	var mu sync.RWMutex
	m := make(map[string]string)
	m["key"] = "value"

	for i := 0; i < b.N; i++ {
		mu.RLock()
		_ = m["key"]
		mu.RUnlock()
	}
}

// $ go test -bench=.
//
// Output:
// goos: linux
// goarch: amd64
// pkg: awesomeProject
// cpu: Intel(R) Core(TM) i9-14900K
// BenchmarkSyncMap-32             163039533                6.953 ns/op
// BenchmarkMutexMap-32            100000000               11.38 ns/op
```

### `sync.Pool` (–ü—É–ª –æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

**`sync.Pool`** ‚Äî –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏ –≤ hot-–∫–æ–¥–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä—Å–∏–Ω–≥ JSON, –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è).

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ GC** (—Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞) **–ø—Ä–∏ —á–∞—Å—Ç–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±—É—Ñ–µ—Ä—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤).

**–í–∞–∂–Ω–æ:**
	–î–ª—è `sync.Pool` –≤—Å–µ–≥–¥–∞ –æ—á–∏—â–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º –≤ –ø—É–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `buf.Reset()`).

#### –ü—Ä–∏–º–µ—Ä

–ü—É–ª –±—É—Ñ–µ—Ä–æ–≤ –¥–ª—è —Å—Ç—Ä–æ–∫:

```go
package main

import (
	"bytes"
	"sync"
)

var bufPool = sync.Pool{
	New: func() any {
		return new(bytes.Buffer) // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –±—É—Ñ–µ—Ä, –µ—Å–ª–∏ –ø—É–ª –ø—É—Å—Ç
	},
}

func getBuffer() *bytes.Buffer {
	return bufPool.Get().(*bytes.Buffer)
}

func putBuffer(buf *bytes.Buffer) {
	buf.Reset() // –û—á–∏—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º
	bufPool.Put(buf)
}

func main() {
	buf := getBuffer()
	defer putBuffer(buf)

	buf.WriteString("Hello, Pool!")
	fmt.Println(buf.String())
}
```

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏

- –ö–∞–∂–¥—ã–π `P` (–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏–∑ GMP) –∏–º–µ–µ—Ç —Å–≤–æ–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à –æ–±—ä–µ–∫—Ç–æ–≤.
- –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—É–ª –ø—É—Å—Ç ‚Äî –±–µ—Ä–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –æ–±—â–µ–≥–æ –ø—É–ª–∞ –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `New()`.
- –û–±—ä–µ–∫—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã —Å–±–æ—Ä—â–∏–∫–æ–º –º—É—Å–æ—Ä–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç.

##### –ü–ª—é—Å—ã

- –°–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ GC.
- –£–º–µ–Ω—å—à–∞–µ—Ç –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è "—Ç—è–∂–µ–ª—ã—Ö" –æ–±—ä–µ–∫—Ç–æ–≤.

##### –ú–∏–Ω—É—Å—ã

- –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ –æ–±—ä–µ–∫—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –ø—É–ª–µ.
- –°–ª–æ–∂–Ω–µ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —É—Ç–µ—á–∫–∏.

# –ü—Ä–æ–±–ª–µ–º—ã –≤ concurrency?

TODO

## Deadlock - —á—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

TODO

## –ß—Ç–æ —Ç–∞–∫–æ–µ Live Lock?

TODO

## –ß—Ç–æ —Ç–∞–∫–æ–µ Data Race / Race Condition?

 –ö–æ–≥–¥–∞ –¥–≤–µ goroutine —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–¥–Ω–æ–π map –∏ –æ–¥–Ω–∞ –∏–∑ –Ω–∏—Ö –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ map.
 –ï—Å–ª–∏ –∏–¥—ë—Ç —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, –ø—Ä–æ–±–ª–µ–º –Ω–∏–∫–∞–∫–∏—Ö –Ω–µ—Ç.

TODO

