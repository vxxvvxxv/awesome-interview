–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
- [Go scheduler. –ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏](https://habr.com/ru/articles/743266/)
- [Dmitry Vyukov ‚Äî Go scheduler: Implementing language with lightweight concurrency](https://www.youtube.com/watch?v=-K11rY57K7k)
- [–ê–Ω—Ç–æ–Ω –°–µ—Ä–≥–µ–µ–≤, ¬´Go –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º¬ª](https://www.youtube.com/watch?v=rloqQY9CT8I)
- [–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Go: –ß–∞—Å—Ç—å I ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –û–°](https://habr.com/ru/articles/478168/)
- [–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Go: –ß–∞—Å—Ç—å II ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go](https://habr.com/ru/articles/489862/)
- [–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤ Golang | –û–ª–µ–≥ –ö–æ–∑—ã—Ä–µ–≤, –ê–≤–∏—Ç–æ](https://www.youtube.com/watch?app=desktop&v=8z6FAaNPA-M)
- [–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go ‚Äî —Å–∞–º—ã–π –ø–æ–¥—Ä–æ–±–Ω—ã–π –≥–∞–π–¥ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º](https://www.youtube.com/watch?v=kedW1xO3Zbo)

---

# –ß—Ç–æ —Ç–∞–∫–æ–µ Scheduler (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)

**Scheduler** ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å —Ä–∞–Ω—Ç–∞–π–º–∞, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–∞–≤–ª—è–µ—Ç:

- —Å–æ–∑–¥–∞–Ω–∏–µ–º,
- –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º,
- –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º `goroutine` –Ω–∞ –ø–æ—Ç–æ–∫–∏ –û–° (`M`),
- –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É —è–¥—Ä–∞–º–∏ (`P`)

| –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                          | –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç                                                |
| ----------------------------------- | ----------------------------------------------------------- |
| –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç goroutine               | –° –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–π –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö, –æ–∂–∏–¥–∞–Ω–∏—è—Ö –∏ —Ç.–¥. |
| –£–ø—Ä–∞–≤–ª—è–µ—Ç `M` (OS thread), `P`, `G` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å `M:P:G`                                   |
| –°—Ç–∞–≤–∏—Ç goroutine –≤ –æ—á–µ—Ä–µ–¥–∏          | `runnable`, `waiting`, `syscall` –∏ —Ç.–¥.                     |
| –ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É                | –ß–µ—Ä–µ–∑ work-stealing –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏                     |

–û–Ω **–Ω–µ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –ø–∞–º—è—Ç—å—é –∏–ª–∏ GC** ‚Äî —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–¥–∞.

# –ú–æ–¥–µ–ª–∏ –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏

| **–ö—Ä–∏—Ç–µ—Ä–∏–π**             | **–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è**             | **–í—ã—Ç–µ—Å–Ω—è—é—â–∞—è**                         |
| ------------------------ | ----------------------------- | --------------------------------------- |
| **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏**  | –ó–∞–¥–∞—á–∏ —Å–∞–º–∏ –æ—Ç–¥–∞—é—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**         | –ù–∏–∑–∫–∞—è (–∑–∞–≤–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ)   | –í—ã—Å–æ–∫–∞—è                                 |
| **–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã**    | –ù–∏–∑–∫–∏–µ                        | –í—ã—Å–æ–∫–∏–µ                                 |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** | –ü—Ä–æ—Å—Ç–∞—è                       | –°–ª–æ–∂–Ω–∞—è                                 |
| **–ü—Ä–∏–º–µ—Ä—ã**              | Windows 3.x, DOS-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è   | Linux, Windows 10, iOS                  |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**        | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã, —Å—Ç–∞—Ä—ã–µ –û–° | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –û–°, —Å–µ—Ä–≤–µ—Ä—ã, –∏–≥—Ä—ã           |

## –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è

–ó–∞–¥–∞—á–∏ (–ø—Ä–æ—Ü–µ—Å—Å—ã/–ø–æ—Ç–æ–∫–∏) **–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –≤—ã–∑–æ–≤ `yield()`. –ü–æ–∫–∞ –∑–∞–¥–∞—á–∞ –Ω–µ –æ—Ç–¥–∞—Å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è.

### –ü–ª—é—Å—ã

- **–ù–∏–∑–∫–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã**:
	- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ —Ç–æ—á–∫–∞—Ö —è–≤–Ω–æ–≥–æ ¬´–æ—Ç–ø—É—Å–∫–∞–Ω–∏—è¬ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
	- –ü—Ä–∏–º–µ—Ä: –í –∏–≥—Ä–∞—Ö 90-—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, _SimCity_) –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∏ –∏ —Ñ–∏–∑–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–ª–∏—Å—å –±—ã—Å—Ç—Ä–æ, —Ç–∞–∫ –∫–∞–∫ –∫–æ–¥ –±—ã–ª –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω.
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
	- –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–ª–æ–∂–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫.
	- –ü—Ä–∏–º–µ—Ä: –†–∞–Ω–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ Windows (3.x) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**:
	- –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ.
	- –ü—Ä–∏–º–µ—Ä: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Å –∂–µ—Å—Ç–∫–∏–º–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏.

### –ú–∏–Ω—É—Å—ã

- **–†–∏—Å–∫ –∑–∞–≤–∏—Å–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã**:
	- –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç `yield()`, —Å–∏—Å—Ç–µ–º–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.
	- –ü—Ä–∏–º–µ—Ä: –í Windows 3.x –∑–∞–≤–∏—Å—à–µ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ¬´–∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–ª–æ¬ª –≤–µ—Å—å –∫–æ–º–ø—å—é—Ç–µ—Ä.
- **–ù–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**:
	- –û–¥–Ω–∞ ¬´–∂–∞–¥–Ω–∞—è¬ª –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –º–æ–Ω–æ–ø–æ–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä.
	- –ü—Ä–∏–º–µ—Ä: –î–æ–ª–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ –±–µ–∑ `yield()` –±–ª–æ–∫–∏—Ä—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏**:
	- –û—à–∏–±–∫–∏ –≤ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—Å—é —Å–∏—Å—Ç–µ–º—É.

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- **–ò–≥—Ä—ã –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏**:
	- –ì–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, _DOOM_ –Ω–∞ MS-DOS).
- **–ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã**:
	- –°–∏—Å—Ç–µ–º—ã –±–µ–∑ –û–°, –≥–¥–µ –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º —Ü–∏–∫–ª–µ —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º.

## –í—ã—Ç–µ—Å–Ω—è—é—â–∞—è

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ **–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏** —á–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –∏—Ö —Å–æ–≥–ª–∞—Å–∏—è.

### –ü–ª—é—Å—ã

- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**:
	- –î–∞–∂–µ ¬´–∑–∞–≤–∏—Å—à–∞—è¬ª –∑–∞–¥–∞—á–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É.
	- –ü—Ä–∏–º–µ—Ä: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –û–° (Linux, Windows) –Ω–µ –∑–∞–≤–∏—Å–∞—é—Ç –∏–∑-–∑–∞ –æ–¥–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- **–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**:
	- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∑–∞–¥–∞—á–∏ –ø–æ–ª—É—á–∞—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–µ –≤—Ä–µ–º—è.
	- –ü—Ä–∏–º–µ—Ä: –°–µ—Ä–≤–µ—Ä—ã, –≥–¥–µ –≤–∞–∂–Ω–æ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- **–ò–∑–æ–ª—è—Ü–∏—è –∑–∞–¥–∞—á**:
	- –û—à–∏–±–∫–∏ –≤ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ.

### –ú–∏–Ω—É—Å—ã

- **–í—ã—Å–æ–∫–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã**:
	- –ß–∞—Å—Ç—ã–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç—Ä–µ–±—É—é—Ç —Ä–µ—Å—É—Ä—Å–æ–≤.
	- –ü—Ä–∏–º–µ—Ä: –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∞) —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –∑–∞–¥–µ—Ä–∂–∫–∞–º.
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**:
	- –ù—É–∂–Ω—ã –º–µ—Ö–∞–Ω–∏–∑–º—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (–º—å—é—Ç–µ–∫—Å—ã, —Å–µ–º–∞—Ñ–æ—Ä—ã) –¥–ª—è –∑–∞—â–∏—Ç—ã –æ–±—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
	- –ü—Ä–∏–º–µ—Ä: Race conditions –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.
- **–ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**:
	- –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –º–æ–º–µ–Ω—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–∞–¥–∞—á.

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã**:
	- Windows, Linux, macOS ‚Äî –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—ã—Ç–µ—Å–Ω—è—é—â—É—é –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å.
- **–°–µ—Ä–≤–µ—Ä–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
	- –í–µ–±-—Å–µ—Ä–≤–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, Nginx) –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Ç—ã—Å—è—á–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
- **–ò–≥—Ä—ã —Å –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å—é**:
	- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞, —Ñ–∏–∑–∏–∫–∏ –∏ AI –ø–æ —Ä–∞–∑–Ω—ã–º –ø–æ—Ç–æ–∫–∞–º.

## –ú–æ–¥–µ–ª—å –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏ –≤ Go

–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
- [GO Scheduler: —Ç–µ–ø–µ—Ä—å –Ω–µ –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π?](https://habr.com/ru/articles/502506/)

–í Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**:

- **–ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã**: –ì–æ—Ä—É—Ç–∏–Ω—ã –º–æ–≥—É—Ç –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ –æ—Ç–¥–∞–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `runtime.Gosched()`.
- **–í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ**:
	- –ì–æ—Ä—É—Ç–∏–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Ç–µ—Å–Ω—è—é—Ç—Å—è –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ (–∫–∞–Ω–∞–ª—ã, I/O).
    - –ù–∞—á–∏–Ω–∞—è —Å Go 1.14, –≥–æ—Ä—É—Ç–∏–Ω—ã **"–≤ –∞–≤–∞—Ä–∏–π–Ω–æ–º —Ä–µ–∂–∏–º–µ"** –≤—ã—Ç–µ—Å–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π).

### –ü—Ä–∏–º–µ—Ä

```go
// –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
go func() {
    for {
        // –î–æ–ª–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
        runtime.Gosched() // –Ø–≤–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ CPU
    }
}()

// –í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
go func() {
    data := <-ch // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚Üí –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –≥–æ—Ä—É—Ç–∏–Ω—É
}()
```

# –ß—Ç–æ —Ç–∞–∫–æ–µ GMP-–º–æ–¥–µ–ª—å?

–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:
- [Analysis of Golang GPM Models](https://www.sobyte.net/post/2022-07/go-gmp/#2-life-cycle-of-m)

**GMP** ‚Äî —ç—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ Go, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω–∞–º–∏, –ø–æ—Ç–æ–∫–∞–º–∏ –û–° –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤. –û–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å.

## –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∫–∞–∂–¥–∞—è –±—É–∫–≤–∞?

### –ö–æ—Ä–æ—Ç–∫–æ

- **G** ‚Äî –≤–∞—à–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã.
- **M** ‚Äî –ø–æ—Ç–æ–∫–∏ –û–°, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç –∫–æ–¥.
- **P** ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç **G** –º–µ–∂–¥—É **M**.

### –î–µ—Ç–∞–ª—å–Ω–µ–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ                                                                                                                                                                                                                                                                                                                                                                    |
| --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **G**     | **Goroutine** ‚Äî –≥–æ—Ä—É—Ç–∏–Ω—ã, –ª–µ–≥–∫–æ–≤–µ—Å–Ω–∞—è ¬´–Ω–∏—Ç—å¬ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ù–µ –ø–æ—Ç–æ–∫ –û–°, –∞ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è Go, —Ç—Ä–µ–±—É—é—â–∞—è –º–∏–Ω–∏–º—É–º —Ä–µ—Å—É—Ä—Å–æ–≤ (2 –ö–ë —Å—Ç–µ–∫–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Ç—ë—Ç).<br><br>–ù–∞ –∫–∞–∂–¥–æ–º **P** –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è **G** –∏ scheduler –∑–∞ —ç—Ç–∏–º —Å–ª–µ–¥–∏—Ç.                                                                                                                                   |
| **M**     | **Machine (OS Thread)** ‚Äî –ø–æ—Ç–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã. –ò–º–µ–Ω–Ω–æ **M** –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–¥ –≥–æ—Ä—É—Ç–∏–Ω. –ö–∞–∂–¥—ã–π **M** –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —è–¥—Ä—É CPU.<br>–ö–∞–∂–¥—ã–π **P** —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ç–æ–∫–µ –∏–∑ **M**. <br><br>–ó–∞–º–µ—Ç—å—Ç–µ, —á—Ç–æ **P** –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–≤–Ω–æ **M**, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω `syscall`'–æ–º –∏ —Ç–æ–≥–¥–∞ –¥–ª—è –µ–≥–æ **P** –±—É–¥–µ—Ç –≤—ã–¥–µ–ª–µ–Ω –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫. –ê –µ—â–µ –µ—Å—Ç—å CGO –∏ –ø—Ä–æ—á–∏–µ –∏ –ø—Ä–æ—á–∏–µ –Ω—é–∞–Ω—Å—ã. |
| **P**     | **Processor (–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä)** ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ—á–µ—Ä–µ–¥—è–º–∏ –≥–æ—Ä—É—Ç–∏–Ω –∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç **M** —Å **G**. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ **P** —Ä–∞–≤–Ω–æ `GOMAXPROCS`  (–∏—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—ã –º–æ–∂–µ–º –ø–æ–º–µ–Ω—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–µ–π `runtime.GOMAXPROCS`, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —á–∏—Å–ª–æ —è–¥–µ—Ä CPU).<br><br>–ù–∞ –∫–∞–∂–¥–æ–º –ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –º–æ–∂–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞.     |

## –ö–∞–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –º–µ–∂–¥—É —Å–æ–±–æ–π?

### –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

1. **P** —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ `GOMAXPROCS` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 4 –¥–ª—è 4-—è–¥–µ—Ä–Ω–æ–≥–æ CPU).
2. –ö–∞–∂–¥—ã–π **P** –∏–º–µ–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å (**local runqueue**) –≥–æ—Ä—É—Ç–∏–Ω (**G**), –≥–æ—Ç–æ–≤—ã—Ö –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é.
3. **M** (–ø–æ—Ç–æ–∫ –û–°) ¬´—Ü–µ–ø–ª—è–µ—Ç—Å—è¬ª –∫ **P** –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –µ–≥–æ –æ—á–µ—Ä–µ–¥–∏.
4. –ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å **P** –ø—É—Å—Ç–∞, –æ–Ω ¬´–∫—Ä–∞–¥–µ—Ç¬ª –≥–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –¥—Ä—É–≥–æ–≥–æ **P** (**work-stealing**).

#### –ü—Ä–∏–º–µ—Ä

```go
func main() {
    go task1() // G1 —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å P1
    go task2() // G2 –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å P1
    time.Sleep(time.Second)
}

func task1() { /*...*/ } // G1
func task2() { /*...*/ } // G2
```

1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å–æ–∑–¥–∞—é—Ç—Å—è **P1**, **P2**, ..., **Pn** (–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —è–¥–µ—Ä).
2. **M1** (–ø–æ—Ç–æ–∫ –û–°) —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å **P1** –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –≥–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –µ–≥–æ –æ—á–µ—Ä–µ–¥–∏.
3. –ï—Å–ª–∏ **G1** –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ I/O), **M1** –æ—Ç—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –æ—Ç **P1**, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—Ç—å, –∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ **M2** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥—Ä—É–≥–∏—Ö –≥–æ—Ä—É—Ç–∏–Ω.

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–∑–æ–≤ time.Sleep, I/O)

1. **G** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `G1`) –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è.
2. **M1** –æ—Ç—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –æ—Ç **P1** –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–æ—Ç–æ–∫ –û–°.
3. **P1** –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –≥–æ—Ä—É—Ç–∏–Ω—É (`G2`) –∏–∑ —Å–≤–æ–µ–π –æ—á–µ—Ä–µ–¥–∏.
4. –ö–æ–≥–¥–∞ `G1` —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –æ–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å **P1** (–∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ **P**).

#### –°–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–º)

1. **G** –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤.
2. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π **M** (–ø–æ—Ç–æ–∫ –û–°), —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å —Ä–µ—Å—É—Ä—Å—ã **P**.
3. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ **G** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å.

#### –ö–∞–Ω–∞–ª—ã (channels) –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

- –ï—Å–ª–∏ **G** –æ–∂–∏–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–∞–Ω–∞–ª–∞, –æ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç **M**, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥—Ä—É–≥–∏–µ **G**.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ GMP-–º–æ–¥–µ–ª–∏

- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**:
	- –¢—ã—Å—è—á–∏ –≥–æ—Ä—É—Ç–∏–Ω —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–º —á–∏—Å–ª–µ –ø–æ—Ç–æ–∫–æ–≤ –û–°.
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å CPU**:
	- **P** –∏ work-stealing –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—é—Ç –ø—Ä–æ—Å—Ç–æ–∏ –ø–æ—Ç–æ–∫–æ–≤.
- **–ù–∏–∑–∫–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã**:
	- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –±–µ–∑ —É—á–∞—Å—Ç–∏—è —è–¥—Ä–∞ –û–°.

## –ü—Ä–∏–º–µ—Ä: –ö–∞–∫ GMP –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 10 000 –≥–æ—Ä—É—Ç–∏–Ω

1. –°–æ–∑–¥–∞—é—Ç—Å—è 10 000 **G** (–≥–æ—Ä—É—Ç–∏–Ω).
2. –û–Ω–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –ª–æ–∫–∞–ª—å–Ω—ã–º –æ—á–µ—Ä–µ–¥—è–º **P** (–Ω–∞–ø—Ä–∏–º–µ—Ä, 4 **P** –¥–ª—è 4 —è–¥–µ—Ä).
3. –ö–∞–∂–¥—ã–π **M** (–ø–æ—Ç–æ–∫ –û–°) –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≥–æ—Ä—É—Ç–∏–Ω—ã –∏–∑ –æ—á–µ—Ä–µ–¥–∏ —Å–≤–æ–µ–≥–æ **P**.
4. –ï—Å–ª–∏ –æ–¥–Ω–∞ **G** –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, **M** –Ω–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥—É—é **G**.

# –û—á–µ—Ä–µ–¥–∏

–ö–æ–≥–¥–∞ –º—ã –∑–∞–ø—É—Å–∫–∞–µ–º `go func()`, —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è `goroutine`, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ **–≤—ã–ø–æ–ª–Ω–∏—Ç—å**. –≠—Ç–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã —Å—Ç–∞–≤—è—Ç—Å—è –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ **–æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á**, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫.

## –ß—Ç–æ —Ç–∞–∫–æ–µ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å?

- –£ –∫–∞–∂–¥–æ–≥–æ **`P` (Processor)** –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –µ—Å—Ç—å **—Å–≤–æ—è –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å** (`runq`).
- –•—Ä–∞–Ω–∏—Ç `goroutine`, –≥–æ—Ç–æ–≤—ã–µ –∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—é.
- –û—á–µ–Ω—å **–±—ã—Å—Ç—Ä–∞—è**, —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.
- –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω (–æ–±—ã—á–Ω–æ ~256 –∑–∞–¥–∞—á).

## –ß—Ç–æ —Ç–∞–∫–æ–µ –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å?

- **–û–¥–Ω–∞ –Ω–∞ –≤–µ—Å—å —Ä–∞–Ω—Ç–∞–π–º** (`sched.runq`).
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ **—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**, –∫–æ–≥–¥–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω—ã –∏–ª–∏ –ø—É—Å—Ç—ã.
- –ó–∞—â–∏—â–µ–Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π, –¥–æ—Å—Ç—É–ø –º–µ–¥–ª–µ–Ω–Ω–µ–µ.
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ `goroutine`, –æ–Ω–∞ **–º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å** –ª–∏–±–æ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å, –ª–∏–±–æ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é.

## –ö–æ–≥–¥–∞ –∑–∞–¥–∞—á–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –º–µ–∂–¥—É –æ—á–µ—Ä–µ–¥—è–º–∏?

### –õ–æ–∫–∞–ª—å–Ω–∞—è ‚Üí –ì–ª–æ–±–∞–ª—å–Ω–∞—è

- –ö–æ–≥–¥–∞ **–ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞**, –ª–∏—à–Ω–∏–µ `goroutine` —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é.
- –ò–ª–∏ –ø—Ä–∏ **—Å–æ–∑–¥–∞–Ω–∏–∏ –≥–æ—Ä—É—Ç–∏–Ω—ã**, –µ—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—è—Ç—å –µ—ë.

### –ì–ª–æ–±–∞–ª—å–Ω–∞—è ‚Üí –õ–æ–∫–∞–ª—å–Ω–∞—è

–ö–æ–≥–¥–∞ **–ª–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞**, `P` –º–æ–∂–µ—Ç –≤–∑—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞—á –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π (–æ–±—ã—á–Ω–æ _batch_ –∏–∑ 1‚Äì61).

## –ö—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ—á–µ—Ä–µ–¥—è–º–∏?

- **–ö–∞–∂–¥—ã–π `P`** (Processor) —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go** —Ä–µ—à–∞–µ—Ç:
    - –ö–æ–≥–¥–∞ –≤–∑—è—Ç—å –∑–∞–¥–∞—á–∏ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏.
    - –ö–æ–≥–¥–∞ –¥–µ–ª–∞—Ç—å **work stealing** (—Å–º. –Ω–∏–∂–µ).
    - –ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å / –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–∏ (`M`).

## –ö–∞–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ Go?

- **–ü–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏** ‚Äî –æ–Ω–∏ –±—ã—Å—Ç—Ä—ã–µ, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—é—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
- **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π** ‚Äî —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ö–ª–∞–º–ª—è–ª–∏—Å—å.
- **–ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å** ‚Äî –¥–ª—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏.
- **–ï—Å–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–µ—á–µ–≥–æ –¥–µ–ª–∞—Ç—å ‚Äî –¥–µ–ª–∞—Ç—å work stealing** (–≤–æ—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —É –¥—Ä—É–≥–∏—Ö `P`).

## –ß—Ç–æ —Ç–∞–∫–æ–µ **work-stealing**

**Work Stealing** ‚Äî —ç—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π **`P`, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –∑–∞–¥–∞—á, "–≤–æ—Ä—É–µ—Ç" –∑–∞–¥–∞—á–∏ —É –¥—Ä—É–≥–∏—Ö `P`**, —É –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω–∏ –µ—Å—Ç—å.

- –†–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ:
    - –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ (–∫–∞–∂–¥—ã–π —Å–∞–º —Å–µ–±–µ –≤–æ—Ä).
    - –ë–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏.
    - –ú–µ–Ω—å—à–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, —á–µ–º –ø—Ä–∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –æ–±—â–µ–π –æ—á–µ—Ä–µ–¥–∏.

–í Go, –≤–æ—Ä—É—é—Ç **–ø–æ–ª–æ–≤–∏–Ω—É** –∑–∞–¥–∞—á –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏ –¥—Ä—É–≥–æ–≥–æ `P`.

## –ß—Ç–æ —Ç–∞–∫–æ–µ **work-sharing**

**Work-sharing** ‚Äî —ç—Ç–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π **–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è** –º–µ–∂–¥—É –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏ (–ø–æ—Ç–æ–∫–∞–º–∏, –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏) **–≤ –º–æ–º–µ–Ω—Ç –∏—Ö —Å–æ–∑–¥–∞–Ω–∏—è**.

–¢–æ –µ—Å—Ç—å, **–∞–≤—Ç–æ—Ä –∑–∞–¥–∞—á–∏ —Å–∞–º —Ä–µ—à–∞–µ—Ç, –∫–æ–º—É –µ—ë "–æ—Ç–¥–∞—Ç—å"**.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

- –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `goroutine`, –ø–æ—Ç–æ–∫, –∏–ª–∏ —Ç–∞—Å–∫–∞), —Ç–µ–∫—É—â–∏–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å **–ø—ã—Ç–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–¥–∞—Ç—å –µ—ë** –∫–∞–∫–æ–º—É-—Ç–æ –¥—Ä—É–≥–æ–º—É –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é.
- –≠—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å:
    - **–ø–æ –∫—Ä—É–≥—É** (round-robin),
    - –ø–æ —Ç–µ–∫—É—â–µ–π –∑–∞–≥—Ä—É–∑–∫–µ (–µ—Å–ª–∏ –∑–∞–º–µ—Ä—è–µ—Ç—Å—è),
    - —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º,
    - –≤ –æ—á–µ—Ä–µ–¥—å –æ–±—â–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

## –ü—Ä–∏–º–µ—Ä work-sharing

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —É –Ω–∞—Å 4 –ø–æ—Ç–æ–∫–∞, –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö —Å–æ–∑–¥–∞—ë—Ç 10 –∑–∞–¥–∞—á. –û–Ω —Ç—É—Ç –∂–µ –ø—ã—Ç–∞–µ—Ç—Å—è:
- –ó–∞–¥–∞—á—É 1 –æ—Ç–¥–∞—Ç—å –ø–æ—Ç–æ–∫—É 2
- –ó–∞–¥–∞—á—É 2 –æ—Ç–¥–∞—Ç—å –ø–æ—Ç–æ–∫—É 3
- –ó–∞–¥–∞—á—É 3 ‚Äî –ø–æ—Ç–æ–∫—É 4
- –∏ —Ç.–¥.

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è work-sharing:

- –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ OpenMP
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ thread pools
- MPI (–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö)
- –°—Ç–∞—Ä–∞—è –º–æ–¥–µ–ª—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –û–° (—Ä–∞–Ω—å—à–µ –≤ Linux)

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ work-sharing

1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏**, —á—Ç–æ —Å–æ–∑–¥–∞—ë—Ç **—É–∑–∫–æ–µ –º–µ—Å—Ç–æ**.
2. **–û–≤–µ—Ä—Ö–µ–¥ –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** ‚Äî –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–∞–º/–æ—á–µ—Ä–µ–¥—è–º.
3. **–ù–µ—É—Å—Ç–æ–π—á–∏–≤–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞** ‚Äî –µ—Å–ª–∏ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–ª –º–Ω–æ–≥–æ –∑–∞–¥–∞—á, –Ω–æ –æ—Ç–¥–∞—Ç—å –∏—Ö –Ω–µ —É—Å–ø–µ–ª ‚Äî **–¥—Ä—É–≥–∏–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç**.
4. **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É** ‚Äî –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ—Ä–æ—Ç–∫–æ–π –∏–ª–∏ —Ç—è–∂—ë–ª–æ–π, –Ω–æ —É–∂–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞.

### –ö–æ–≥–¥–∞ —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

- –ö–æ–≥–¥–∞ **–≤—Å–µ –∑–∞–¥–∞—á–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–≤–Ω—ã –ø–æ –≤–µ—Å—É**.
- –ö–æ–≥–¥–∞ **—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á ‚Äî —Ä–µ–¥–∫–æ—Å—Ç—å**, –∏ –≤–∞–∂–Ω–µ–µ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞.
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ **—Å—Ç—Ä–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –≥–¥–µ —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏–≤—è–∑–∫–∞ –∫ NUMA-—É–∑–ª—É, CPU –∏ —Ç.–¥.)

## –ü–æ—á–µ–º—É –≤ Go **work-stealing**, –∞ –Ω–µ **work-sharing**

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞          | Work-sharing üß∫            | Work-stealing üïµÔ∏è‚Äç‚ôÇÔ∏è     |
| ----------------------- | -------------------------- | ------------------------ |
| –ö—Ç–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ | –¢–æ—Ç, –∫—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–¥–∞—á—É    | –¢–æ—Ç, –∫—Ç–æ **–∏—â–µ—Ç** –∑–∞–¥–∞—á—É |
| –ö–æ–≥–¥–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è    | –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏               | –ü—Ä–∏ –ø—Ä–æ—Å—Ç–æ–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è  |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å        | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è (—É–∑–∫–æ–µ –º–µ—Å—Ç–æ) | –û—Ç–ª–∏—á–Ω–∞—è                 |
| –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏   | –ù–µ –≤—Å–µ–≥–¥–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞       | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è, –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è |

- –ü–æ—Ç–æ–º—É —á—Ç–æ Go –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å** –∏ **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**.
- `goroutine` –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è **–≤–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞**, —Ç—ã—Å—è—á–∏ —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É.
- –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é –∑–∞–¥–∞—á—É –≤—Ä—É—á–Ω—É—é = –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, —Ç.–µ. –º–µ–¥–ª–µ–Ω–Ω–æ.
- –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:
    - –ó–∞–¥–∞—á–∞ **–∫–ª–∞–¥—ë—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –æ—á–µ—Ä–µ–¥—å**, –∏ –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç ‚Äî –æ–Ω —Å–∞–º –µ—ë **—É–∫—Ä–∞–¥—ë—Ç** (work-stealing).

–ü–æ—ç—Ç–æ–º—É **Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç work-stealing** ‚Äî —ç—Ç–æ **lock-free** –∏ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏** –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

## –í –∫–∞–∫–æ–π –º–æ–º–µ–Ω—Ç goroutine –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è?

**Goroutine –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –Ω–µ "–≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è", –∞ –≤ —Å—Ç—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö**, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å–∞–º–∏–º —Ä–∞–Ω—Ç–∞–π–º–æ–º. –≠—Ç–æ **–∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å**, –∞ –Ω–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è, –∫–∞–∫ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö.

### –ü—Ä–∏–º–µ—Ä—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã**, –∫–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ Go –º–æ–∂–µ—Ç **–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥—É—é –≥–æ—Ä—É—Ç–∏–Ω—É**:

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã / –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ `goroutine` –¥–µ–ª–∞–µ—Ç —á—Ç–æ-—Ç–æ, —á—Ç–æ **–º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, I/O, –æ–∂–∏–¥–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞, `select`, `time.Sleep`, `sync.Mutex.Lock`, `cond.Wait` –∏ —Ç.–¥.), –æ–Ω–∞ **–ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è**, –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥—Ä—É–≥—É—é.

```go
<-ch         // –±–ª–æ–∫–∏—Ä—É—é—â–∏–π recv
ch <- value  // –±–ª–æ–∫–∏—Ä—É—é—â–∏–π send
```

### –†—É—á–Ω–æ–π `runtime.Gosched()`

–ü–æ–∑–≤–æ–ª—è–µ—Ç **–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ —É—Å—Ç—É–ø–∏—Ç—å** —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–æ–π `goroutine`.

```go
runtime.Gosched()
```

### –í–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å `channel`, `select`, `lock` –∏–ª–∏ `time.Sleep` 

Go –∑–Ω–∞–µ—Ç, —á—Ç–æ –æ–Ω–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ–∂–∏–¥–∞–Ω–∏—é ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ.

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π `goroutine`

–ö–æ–≥–¥–∞ —Ç—ã –≤—ã–∑—ã–≤–∞–µ—à—å `go f()`, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ **–º–æ–∂–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è** –Ω–∞ –Ω–µ—ë (–Ω–æ –Ω–µ –æ–±—è–∑–∞–Ω).

### –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ (preemption)

–ù–∞—á–∏–Ω–∞—è —Å Go 1.14, –ø–æ—è–≤–∏–ª–∞—Å—å **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–µ–¥–≤—ã–±–æ—Ä–∫–∞**:

> –î–∞–∂–µ –µ—Å–ª–∏ `goroutine` "–∑–∞–Ω—è—Ç–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º —Ü–∏–∫–ª–æ–º", –æ–Ω–∞ **–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞**.

–≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ä–∞–∑ –≤ 10–º—Å, –∏ **–≤—Å—Ç–∞–≤–ª—è–µ—Ç "—Ç–æ—á–∫—É –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è"** –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏).

–ù–∞–ø—Ä–∏–º–µ—Ä:

```go
for {
    x++
}
```

–í —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Go —ç—Ç–æ –º–æ–≥–ª–æ **–Ω–∞–º–µ—Ä—Ç–≤–æ –∑–∞–Ω—è—Ç—å CPU**. –°–µ–π—á–∞—Å ‚Äî –Ω–µ—Ç, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É–º–µ–µ—Ç **–ø—Ä–µ—Ä—ã–≤–∞—Ç—å "–∂–∞–¥–Ω—É—é" –≥–æ—Ä—É—Ç–∏–Ω—É**.

### –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ `function calls`

Go –≤—Å—Ç–∞–≤–ª—è–µ—Ç **"—Ç–æ—á–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è"** –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–π, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Ñ–ª–∞–≥ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ `preemptible`.

### –°–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞ (GC)

–í–æ –≤—Ä–µ–º—è **—Å—Ç–æ–ø-–º–∏—Ä** —Ñ–∞–∑—ã (–∫–æ—Ä–æ—Ç–∫–æ–π), –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –º–æ–∂–µ—Ç —Ç–æ–∂–µ –ø–æ–º–µ–Ω—è—Ç—å —Ç–µ–∫—É—â—É—é –≥–æ—Ä—É—Ç–∏–Ω—É.

## –ö–∞–∫ Go —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å?

- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –¥—Ä—É–≥–∏–µ `goroutine`, –≥–æ—Ç–æ–≤—ã–µ –∫ –∑–∞–ø—É—Å–∫—É (`runnable`).
- –ï—Å–ª–∏ —Ç–µ–∫—É—â–∞—è –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏–ª–∏ —è–≤–Ω–æ —É—Å—Ç—É–ø–∏–ª–∞ (`Gosched`), –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è.
- –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–µ–∫—É—â–∞—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.


–ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ `G` –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, `M` –º–æ–∂–µ—Ç –ª–∏–±–æ:
- –í–µ—Ä–Ω—É—Ç—å `P` –≤ –ø—É–ª (–∏ –ø–æ–¥—Ü–µ–ø–∏—Ç—å –¥—Ä—É–≥–æ–π `G`),
- –õ–∏–±–æ —Å–∞–º —É–π—Ç–∏ –≤ —Å–æ–Ω, –µ—Å–ª–∏ –Ω–µ—Ç –∑–∞–¥–∞—á.

| –°–æ–±—ã—Ç–∏–µ                 | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è      |
| ----------------------- | ----------------------------- |
| –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª–µ    | ‚úÖ –î–∞                          |
| `select`                | ‚úÖ –î–∞                          |
| `time.Sleep`, `sync`    | ‚úÖ –î–∞                          |
| `runtime.Gosched()`     | ‚úÖ –î–∞                          |
| –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ (–∏–Ω–æ–≥–¥–∞)  | ‚úÖ –î–∞ (—Ç–æ—á–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è)       |
| –î–æ–ª–≥–∏–π —Ü–∏–∫–ª –±–µ–∑ –≤—ã–∑–æ–≤–æ–≤ | ‚ùå (–¥–æ Go 1.14), ‚úÖ (—Å–µ–π—á–∞—Å)    |
| –ù–æ–≤—ã–π `go func()`       | ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ |

# –ß—Ç–æ —Ç–∞–∫–æ–µ netpoller

[Source code](https://github.com/golang/go/blob/master/src/runtime/netpoll.go)

`netpoller` ‚Äî —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Go-—Ä–∞–Ω—Ç–∞–π–º–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –æ–∂–∏–¥–∞–Ω–∏–µ–º —Å–µ—Ç–µ–≤—ã—Ö (–∏ –¥—Ä—É–≥–∏—Ö) —Å–æ–±—ã—Ç–∏–π**, —Ç–∞–∫–∏—Ö –∫–∞–∫:

- —Å–æ–∫–µ—Ç —Å—Ç–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–ª–∏ –∑–∞–ø–∏—Å–∏
- –ø—Ä–æ–∏–∑–æ—à—ë–ª —Ç–∞–π–º–∞—É—Ç
- —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ –∏ —Ç.–¥.

–û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —á—Ç–æ–±—ã **–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å** goroutine, –∫–æ—Ç–æ—Ä—ã–µ –∂–¥—É—Ç –æ—Ç–≤–µ—Ç–∞ –ø–æ —Å–µ—Ç–∏, –∏ **–ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –∏—Ö –≤ —Å–ø—è—â–∏–π —Ä–µ–∂–∏–º**, –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ –≥–æ—Ç–æ–≤—ã.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

- Go –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:
    - `epoll` (Linux)
    - `kqueue` (macOS/BSD)
    - `IOCP` (Windows)
1. –ö–æ–≥–¥–∞ goroutine –≤—ã–∑—ã–≤–∞–µ—Ç `net.Conn.Read()` –∏–ª–∏ `Write()` ‚Äî –æ–Ω–∞ **–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ –Ω–∞–ø—Ä—è–º—É—é**.
2. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:
    - —Å–æ–∑–¥–∞—ë—Ç—Å—è **–∂–¥—É—â–∞—è –∑–∞–ø–∏—Å—å (pollDesc)**, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–∞—è –∫ —Å–æ–∫–µ—Ç—É
    - goroutine **–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–æ–Ω**
3. –ö–æ–≥–¥–∞ —Å–æ–∫–µ—Ç –≥–æ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å):
    - netpoller –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –æ—Ç –û–°
    - –ø–æ–¥–Ω–∏–º–∞–µ—Ç goroutine –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (`runnable`)

–í—Å—ë —ç—Ç–æ **—ç–∫–æ–Ω–æ–º–∏—Ç –ø–æ—Ç–æ–∫–∏ –û–°**, –∏ –¥–µ–ª–∞–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–º–∏**.

### –ö–∞–∫—É—é —Ä–æ–ª—å –∏–≥—Ä–∞–µ—Ç

–ù—É–∂–µ–Ω, —á—Ç–æ–±—ã:

- –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å goroutine –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Å–µ—Ç—å—é
- –£–º–µ—Ç—å "—Å–ø–∞—Ç—å" –∏ "–ø—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è", –∫–æ–≥–¥–∞ —Å–æ–∫–µ—Ç –≥–æ—Ç–æ–≤
- –†–∞–±–æ—Ç–∞—Ç—å —Å —Ç—ã—Å—è—á–∞–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## –ß—Ç–æ —Ç–∞–∫–æ–µ **–∂–¥—É—â–∞—è –∑–∞–ø–∏—Å—å (pollDesc)**

`pollDesc` ‚Äî —ç—Ç–æ **—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–∞–Ω—Ç–∞–π–º Go –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –∫ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—É —Ñ–∞–π–ª–∞/—Å–æ–∫–µ—Ç–∞** (FD), —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ–º —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π.

–û–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:

- –§–ª–∞–≥–∏ (–º–æ–∂–Ω–æ –ª–∏ —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å)
- –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å–≤—è–∑–∞–Ω–Ω—É—é `goroutine`    
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è
- –¢–∞–π–º–∞—É—Ç—ã

### –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è `pollDesc`

- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `net.Dial`, `net.Listen`, `conn.Read()`, `conn.Write()` –∏ —Ç.–¥.
- Go —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç FD –≤ `netpoller` (–Ω–∞–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ `epoll_ctl` –Ω–∞ Linux)
- –°–æ–∑–¥–∞—ë—Ç `pollDesc`, —á—Ç–æ–±—ã:
    - ‚Äú–ø–∞—Ä–∫–æ–≤–∞—Ç—å‚Äù goroutine
    - –∏ ‚Äú—Ä–∞–∑–±—É–¥–∏—Ç—å‚Äù, –∫–æ–≥–¥–∞ –û–° —Å–∫–∞–∂–µ—Ç: "–≥–æ—Ç–æ–≤–æ"

### –í–∏–∑—É–∞–ª—å–Ω–æ

```go
Goroutine (G)
   ‚îÇ
   ‚ñº
net.Conn.Read()
   ‚îÇ
   ‚ñº
create pollDesc ‚îÄ‚îÄ‚îÄ‚ñ∂ register in epoll/kqueue
   ‚îÇ
   ‚ñº
runtime.park() ‚Üí G status = waiting
```

–ö–æ–≥–¥–∞ –û–° —Å–æ–æ–±—â–∞–µ—Ç: ‚Äú–º–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å‚Äù, —Ç–æ **netpoller**:

```go
‚Üí pollDesc –≥–æ—Ç–æ–≤
‚Üí —Å–≤—è–∑–∞–Ω–Ω–∞—è goroutine —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è runnable
‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
```

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å goroutine, –∫–æ–≥–¥–∞ –æ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–æ —Å–µ—Ç–∏

–ï—Å–ª–∏ –≤—ã–∑—ã–≤–∞–µ–º:

```go
resp, err := http.Get("http://example.com")
```

–¢–æ–≥–¥–∞:

1. –ó–∞–ø—Ä–æ—Å —É—Ö–æ–¥–∏—Ç –≤ —Å–µ—Ç—å, goroutine –≤—ã–∑—ã–≤–∞–µ—Ç `netpoll`
2. Goroutine **‚Äú–ø–∞—Ä–∫—É–µ—Ç—Å—è‚Äù** (–ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, —Å–Ω–∏–º–∞–µ—Ç—Å—è —Å `P`)
3. –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—à–ª–∏, netpoll **–±—É–¥–∏—Ç goroutine** –∏ –æ–Ω–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–í–∞–∂–Ω–æ**: –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ goroutine –±–ª–∞–≥–æ–¥–∞—Ä—è netpoll'—É

## –ü—Ä–∏–º–µ—Ä

–ö–æ–¥ –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:

```go
package main

import (
    "fmt"
    "net"
    "time"
)

func main() {
    go func() {
        conn, _ := net.Dial("tcp", "example.com:80")
        fmt.Println("connected", conn != nil)
    }()
    time.Sleep(time.Second * 2)
}
```

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ  `GODEBUG=netpoll=1,schedtrace=1000` ‚Äî —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ –≤ –ª–æ–≥–∞—Ö, –∫–∞–∫ netpoll –∏ sysmon —Ä–∞–±–æ—Ç–∞—é—Ç.

# –ß—Ç–æ —Ç–∞–∫–æ–µ sysmon?

`sysmon` (System Monitor) ‚Äî —ç—Ç–æ **—Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Ä–∞–Ω—Ç–∞–π–º–∞ Go**, –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ "—Å–º–æ—Ç—Ä–∏—Ç–µ–ª—å" –∑–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–æ–π —Ä–∞–Ω—Ç–∞–π–º–∞.

### –ö–∞–∫—É—é —Ä–æ–ª—å –∏–≥—Ä–∞–µ—Ç?

–í—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –∑–∞–¥–∞—á:

1. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–ø—è—â–∏–µ goroutine, –æ–∂–∏–¥–∞—é—â–∏–µ syscall**    
2. **–°–ª–µ–¥–∏—Ç –∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ –∏ –∑–∞–≤–∏—Å—à–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏**
3. **–†–µ—Å—Ç–∞—Ä—Ç—É–µ—Ç netpoller –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏**
4. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã (`time.Sleep`, `Timer`)**
5. **–ó–∞–ø—É—Å–∫–∞–µ—Ç GC –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏**
6. **–î–µ–ª–∞–µ—Ç preemption (–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö goroutine)**

–¢–∞–∫–∂–µ –æ–Ω:

- **–±—É–¥–∏—Ç goroutine**, –µ—Å–ª–∏ syscall –∑–∞–∫–æ–Ω—á–∏–ª—Å—è
- **–¥–µ–ª–∞–µ—Ç preemption** (–µ—Å–ª–∏ –æ–¥–Ω–∞ goroutine "–∑–∞–ª–∏–ø–ª–∞" –∏ –º–µ—à–∞–µ—Ç –¥—Ä—É–≥–∏–º)

# –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ `syscall`?

[Source code](https://github.com/golang/go/tree/master/src/syscall)

–ö–æ–≥–¥–∞ goroutine –≤—ã–∑—ã–≤–∞–µ—Ç **—Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤**, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```go
os.Open("file.txt") // –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä—É—é—â–∏–π syscall
```

1. **Syscall –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –û–° (M)**
2. Go **–ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å** —ç—Ç–æ:
    - –ï—Å–ª–∏ –≤—ã–∑–æ–≤ –±—ã—Å—Ç—Ä—ã–π ‚Äî –≤—Å—ë –æ–∫
    - –ï—Å–ª–∏ **–∑–∞–¥–µ—Ä–∂–∫–∞ >10Œºs**, sysmon –ø–æ–Ω–∏–º–∞–µ—Ç: M –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
3. –¢–æ–≥–¥–∞:
    - Goroutine, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑–≤–∞–ª–∞ `syscall`, –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–π
    - –ù–æ Go —Å–æ–∑–¥–∞—ë—Ç **–Ω–æ–≤—ã–π M**, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–ª `P`
    - –î—Ä—É–≥–∏–µ goroutine –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è
